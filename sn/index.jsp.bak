<%@ page language="java" import="java.io.*,java.util.*" pageEncoding="UTF-8"%>
    <%
               String path = request.getContextPath();
    %>
<%
//out.println("samni, welcome");
 // 接收XML数据
BufferedReader br = new BufferedReader(new InputStreamReader((ServletInputStream)request.getInputStream()));
String line = null;
StringBuilder sb = new StringBuilder();
while((line = br.readLine())!=null){
   sb.append(line);
}
// 取出发送用户
String xmlS = sb.toString();
//out.println(xmlS);

if(xmlS !=null && !xmlS.equals("")){

int fromuser_s = xmlS.indexOf("<FromUserName><![CDATA[");
int fromuser_e = xmlS.indexOf("]]></FromUserName>");
String fromuser = xmlS.substring(fromuser_s + 23, fromuser_e);

// 取出目标用户
int touser_s = xmlS.indexOf("<ToUserName><![CDATA[");
int touser_e = xmlS.indexOf("]]></ToUserName>");
String touser = xmlS.substring(touser_s + 21, touser_e);

// 取出发送内容
int content_s = xmlS.indexOf("<Content><![CDATA[");
int content_e = xmlS.indexOf("]]></Content>");

String content = xmlS.substring(content_s + 18, content_e);

out.print("<xml>");
out.print("    <ToUserName><![CDATA["+fromuser+"]]></ToUserName>");
out.print("    <FromUserName><![CDATA["+touser+"]]></FromUserName>");
out.print("    <CreateTime>"+new Date().getTime()+"</CreateTime>");
out.print("    <MsgType><![CDATA[text]]></MsgType>");
out.print("    <Content><![CDATA[Welcome, you are my first guest!]]></Content>");
out.print("    <FuncFlag>0</FuncFlag>");
out.print("</xml>"); 
}
%>
